<%# trader fund requests %>
<div class="card p-3 mb-4">
  <h5 class="mb-3">Fund Requests</h5>
  <table class="table table-sm table-bordered border-secondary table-hover text-center">
    <thead class="table-dark">
      <tr>
        <th scope="col" style="width: 20%;">Requestor</th>
        <th scope="col" style="width: 12%;">Amount</th>
        <th scope="col" style="width: 10%;">Type</th>
        <th scope="col" style="width: 10%;">Status</th>
        <th scope="col" style="width: 14%;">Date Requested</th>
        <th scope="col" style="width: 14%;">Date Approved</th>
        <th scope="col" style="width: 20%;">Actions</th>
      </tr>
    </thead>
    <tbody class="table-group-divider">
      <% if @all_funds.present? %>
        <% sorted_funds = @all_funds.sort_by { |fund| [ fund.status == "pending" ? 0 : (fund.status == "approved" ? 1 : 2), -fund.created_at.to_i ] } %>
  
        <% sorted_funds.each do |fund| %>
          <tr>
            <td><%= "#{fund.user.first_name} #{fund.user.last_name}" %></td>
            <td><%= number_to_currency(fund.amount) %></td>
            <td><%= fund.fund_type.capitalize %></td>
            <td><%= fund.status.capitalize %></td>
            <td><%= fund.created_at&.in_time_zone("Asia/Manila")&.strftime("%b %d, %Y") %></td>
            <td>
              <% if fund.approved? %>
                <%= fund.updated_at&.in_time_zone("Asia/Manila")&.strftime("%b %d, %Y") %>
              <% elsif fund.rejected? %>
                <span>--</span>
              <% else %>
                <span>Pending</span>
              <% end %>
            </td>
            <td>
              <div class="d-flex gap-1">
                <%= link_to 'View', admin_fund_path(fund), class: "btn btn-outline-secondary btn-sm" %>
                <% if fund.pending? %>
                  <%= button_to 'Approve', approve_admin_fund_path(fund),
                    method: :patch,
                    data: { confirm: "Approve this request?" },
                    class: "btn btn-outline-success btn-sm" %>
                  <%= button_to 'Reject', reject_admin_fund_path(fund),
                    method: :patch,
                    data: { confirm: "Reject this request?" },
                    class: "btn btn-outline-danger btn-sm" %>
                <% end %>
              </div>
            </td>
          </tr>
        <% end %>
      <% else %>
        <tr>
          <td colspan="7">No pending fund request found.</td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

